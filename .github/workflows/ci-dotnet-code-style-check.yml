name: .NET Code Style Check

permissions:
    contents: read
    pull-requests: write
    checks: write

on:
    push:
        branches: ["main", "develop"]
    pull_request:
        branches: ["main", "develop"]

jobs:
    dotnet-code-style-check:
        name: .NET Code Style Check
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Setup .NET
              uses: actions/setup-dotnet@v4
              with:
                  dotnet-version: 8.0.x

            - name: Restore dependencies
              run: dotnet restore

            - name: Build
              run: dotnet build --no-restore

            - name: Setup InspectCode tool
              run: |
                  dotnet new tool-manifest --force
                  dotnet tool install JetBrains.ReSharper.GlobalTools --version 2025.2.3
                  dotnet tool restore

            - name: Run InspectCode
              run: |
                  dotnet jb inspectcode InspectCodeTestProject/InspectCodeTestProject.csproj --output=report.sarif --format=sarif || true

            - name: Publish InspectCode Report Artifact
              uses: actions/upload-artifact@v4
              with:
                  name: report-sarif
                  path: report.sarif

            - name: Generate Markdown Report
              if: always()
              uses: denbudins/jb-inspect-summary-action@main
              with:
                  report-path: ./report.sarif
